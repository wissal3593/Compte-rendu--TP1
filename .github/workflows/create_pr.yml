name: Auto Create Pull Request

on:
  push:
    branches:
      - "*"
      - "!main" # Exclude main branch

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pull-request:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Create Pull Request
        env:
          GH_TOKEN: ${{ secrets.GHA_AUTO_PR_TOKEN }}
        run: |
          BRANCH_NAME="${GITHUB_REF#refs/heads/}"
          echo "Creating PR for branch: $BRANCH_NAME"

          # Check if PR already exists
          if gh pr list --head "$BRANCH_NAME" --json number --jq '.[0].number' | grep -q .; then
            echo "PR already exists for branch $BRANCH_NAME, skipping creation"
            exit 0
          fi

          gh pr create \
            --title "Auto PR: $BRANCH_NAME" \
            --body "This pull request was automatically created for branch \`$BRANCH_NAME\`" \
            --base main \
            --head "$BRANCH_NAME"